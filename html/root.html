<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>r/Splatoon Profile</title>
	<meta http-equiv="Content-Security-Policy" content="default-src * gap: data: blob: 'unsafe-inline' 'unsafe-eval' ws: wss:;">

	<meta name="description" content="r/Splatoon profile pages - share your friend code and game stats!">
	<meta name="keywords" content="Splatoon, r/Splatoon, friend code, profile">
	<meta name="author" content="shane#1353">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="apple-touch-icon" sizes="180x180" href="/fav/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/fav/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/fav/favicon-16x16.png">
	<link rel="manifest" href="/fav/site.webmanifest">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="/css/root.css">
</head>
<body>
	<div class="container" style="margin-bottom:100px;padding-left:0;padding-right:0;">
		<div class="jumbotron">
			<div>
				<a href="https://discord.gg/rsplatoon" target="_blank">
					<img class="center-block" src="/css/img/logo.png" style="width:300px;height:auto;margin-top:0"/>
				</a>
				<h1>Profile</h1>
			</div>
            <% if (id) { %>
				<div id="userinfo">
					<div class="usermenu" style="display: none;">
						<div style="height:70px;width:1px;"></div>
						<div class="item">
							<form action="/delete" method="post">
								<input type="hidden" name="delete" value="YES" />
								<a href="#" onclick="$(this).closest('form').submit();return false;">
									Delete Profile
								</a>
							</form>
						</div>
						<div class="item">
							<a href="/logout">
								Logout
							</a>
						</div>
					</div>
					<img src="<%= avatar %>" onclick="toggleusermenu()" />
					<script>
						function toggleusermenu() {
							$(".usermenu").slideToggle();
						}
					</script>
				</div>
            <% } %>
		</div>
		<div>
            <% if (id) {%>
				<% if (profileId) { %>
					<form>
						<label for="copy-input">Your Profile Link</label>
						<div class="input-group" onclick="copyToClipboard()">
						  	<input type="text" class="form-control"
							  	value="<%= baseUrl %>/p/<%= profileId %>?_v=<%= new Date().valueOf() %>" id="copy-input" readonly>
						  	<span class="input-group-btn">
								<button class="btn btn-default" type="button" id="copy-button"
									data-toggle="tooltip" data-placement="button"
									title="Copy to Clipboard">
							  		<i class="fa fa-copy"></i>
								</button>
						  	</span>
						</div>
						<script>
							function copyToClipboard() {
								console.log("going");
								$("#copy-input").focus();
								$("#copy-input").select();
								document.execCommand("copy");
							}
						</script>
					</form>
				<% } %>
				<form action="/save" method="post">
					<div class="form-group">
						<label for="friendcode">Friend Code</label>
						<input type="text" class="form-control" name="friendcode" value="<%= friendCode %>" data-original="<%= friendCode %>" id="friendcode" placeholder="0000-0000-0000" required />
						<div class="invalid-feedback">
							Friend code invalid format.
						</div>
						<button id="submit" type="submit" class="btn btn-primary" disabled>Save</button>
						<script>
							$(document).ready(function() {
								$("#friendcode").bind("input propertychange", function() {
									var current = $(this).val();
									current = current.replace(/[^0-9]/g,'');

									if (current) {
										var final = "";

										for (var i = 0; i < current.length; i++) {
											if (i === 12)
												break;

											if (i === 4 || i === 8)
												final += "-";

											final += current[i];
										}

										$(this).val(final);

										if (final !== $(this).data("original") && final.length === 14)
											$("#submit").prop("disabled", false);
										else 
											$("#submit").prop("disabled", true);
									} else {
										$("#submit").prop("disabled", true);
									}
								});
							})
						</script>
					</div>
				</form>
            <% } else { %>
                <div class="nameentry needtologin">
                    <a id="loginDiscord" href="<%= loginUrl %>">
                        <button class="btn btn-primary" type="button">Discord Login</button>
                    </a>
                </div>
            <% } %>
		</div>
	</div>
</body>
</html>