<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>r/Splatoon Profile</title>
	<meta http-equiv="Content-Security-Policy" content="default-src * gap: data: blob: 'unsafe-inline' 'unsafe-eval' ws: wss:;">

	<meta name="description" content="r/Splatoon profile pages - share your friend code and game stats!">
	<meta name="keywords" content="Splatoon, r/Splatoon, friend code, profile">
	<meta name="author" content="shane#1353">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="apple-touch-icon" sizes="180x180" href="/fav/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/fav/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/fav/favicon-16x16.png">
	<link rel="manifest" href="/fav/site.webmanifest">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="/css/root.css">
</head>
<body>
	<div class="container" style="margin-bottom:100px;padding-left:0;padding-right:0;">
		<div class="jumbotron">
			<div>
				<a href="https://discord.gg/rsplatoon" target="_blank">
					<img class="center-block" src="/css/img/logo.png" style="width:300px;height:auto;margin-top:0"/>
				</a>
				<h1>Team</h1>
			</div>
            <% if (id) { %>
				<div id="userinfo">
					<div class="usermenu" style="display: none;">
						<div style="height:70px;width:1px;"></div>
						<div class="item">
							<a href="/settings">
								Settings
							</a>
						</div>
						<div class="item">
							<form action="/delete" method="post">
								<input type="hidden" name="delete" value="YES" />
								<a href="#" onclick="$(this).closest('form').submit();return false;">
									Delete Profile
								</a>
							</form>
						</div>
						<div class="item">
							<a href="/logout">
								Logout
							</a>
						</div>
					</div>
					<img src="<%= avatar %>" onclick="toggleusermenu()" />
					<script>
						function toggleusermenu() {
							$(".usermenu").slideToggle();
						}
					</script>
				</div>
            <% } %>
			<a class="btn btn-primary" href="/" role="button">Home</a>
		</div>
		<% if (tournamentTeam) { %>
			<div class="container">
				<div class="row" style="margin-bottom: 14px;">
					<div class="col-8 offset-2">
						<h3><%= username %> is on team <%= tournamentTeam.name %></h3>
					</div>
				</div>
				<div class="row" style="margin-bottom: 14px;">
					<div class="col-8 offset-2">
						<h4>Team Captain: <%= tournamentTeam.captain %></h4>
					</div>
				</div>
				<div class="row" style="margin-bottom: 14px;">
					<div class="col-8 offset-2">
						<h3>Members</h3>
					</div>
				</div>
				<% var first = true; %>
				<% tournamentTeam.team.forEach(function (member) { %>
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-1 offset-2">
							<% if (!first) { %>
							<button class="btn btn-primary" type="button" style="margin-top:auto;margin-bottom:auto;"><i class="fa fa-close"></i></button>
							<% } first = false; %>
						</div>
						<div class="col-1">
							<img src="<%= member.avatar %>" style="width:50px;" />
						</div>
						<div class="col-6">
							<h5>
								<%= member.name %>
							</h5>
							<div>
								<%= member.userId %>
							</div>
							
							<input type="hidden" class="form-control" name="team[]" value="<%= member.userId %>" />
						</div>
					</div>
				<% }); %>
				<% for (var i = 0; i < 6 - tournamentTeam.team.length; i++) { %>
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-8 offset-2">
							<input type="text" class="form-control" name="team[]" value="" placeholder="User" />
						</div>
					</div>
				<% } %>
			</div>
		<% } else { %>
			<form action="/team/register" method="post">
				<div class="container">
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-8 offset-2">
							<h2>Register a team</h2>
						</div>
					</div>
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-8 offset-2">
							<h3>Team Name</h3>
							<input type="text" class="form-control" name="name" value="" id="name" placeholder="Team Name" required aria-required />
						</div>
					</div>
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-8 offset-2">
							<h3>Members</h3>
						</div>
					</div>
					<div class="row no-gutters" style="margin-bottom: 14px;">
						<div class="col-1 offset-2 no-gutters"></div>
						<div class="col-1 no-gutters">
							<img src="<%= avatar %>" style="width:100%; max-width:50px;" />
						</div>
						<div class="col-6 no-gutters">
							<h5>
								<%= username %>
							</h5>
							<div>
								<%= id %>
							</div>
						</div>
					</div>
					<% for (var i = 0; i < 5; i++) { %>
						<div class="row no-gutters" style="margin-bottom: 14px;">
							<div class="col-1 offset-2 no-gutters">
								<button class="btn btn-primary float-center" type="button" style="margin-top:auto;margin-bottom:auto;display:none;"><i class="fa fa-close"></i></button>
							</div>
							<div class="col-1 no-gutters">
								<img src="/css/img/blackpixel.png" style="width:100%;max-width: 50px;" />
							</div>
							<div class="col-6 no-gutters">
								<div class="input-group">
									<input type="text" class="form-control discord-search-text" name="team[]" value="" placeholder="User" required aria-required />
									<div class="input-group-append">
										<button class="btn btn-outline-secondary discord-search" type="button">Search</button>
									</div>
								</div>
							</div>
						</div>
					<% } %>
					<script>
						$(document).ready(function() {
							var nouserhtml = `<div class="col-1 offset-2 no-gutters">
								<button class="btn btn-primary float-center" type="button" style="margin-top:auto;margin-bottom:auto;display:none;"><i class="fa fa-close"></i></button>
							</div>
							<div class="col-1 no-gutters">
								<img src="/css/img/blackpixel.png" style="width:100%;max-width: 50px;" />
							</div>
							<div class="col-6 no-gutters">
								<div class="input-group">
									<input type="text" class="form-control discord-search-text" name="team[]" value="" placeholder="User" required aria-required />
									<div class="input-group-append">
										<button class="btn btn-outline-secondary discord-search" type="button">Search</button>
									</div>
								</div>
							</div>`;
							var newrowhtml = `<div class="col-1 offset-2">
									<button class="btn btn-primary remove-user" type="button" style="margin-top:auto;margin-bottom:auto;"><i class="fa fa-close"></i></button>
								</div>
								<div class="col-1">
									<img class="user-avatar" src="" style="width:50px;" />
								</div>
								<div class="col-6">
									<h5 class="username"></h5>
									<div class="userid"></div>
									
									<input type="hidden" class="form-control userid-value" name="team[]" value="" />
								</div>`;

							function deleteRow() {
								var button = $(this);
								var row = button.closest(".row");
								row.empty();

								row.append(nouserhtml);

								row.find(".discord-search").click(discordSearch);
							}

							function discordSearch() {
								var button = $(this);
								var row = button.closest(".row");
								var input = row.find(".discord-search-text");

								var newrow = $(newrowhtml);
								var founduser = newrow.find(".user-found");
								var avatar = newrow.find(".user-avatar");
								var username = newrow.find(".username");
								var userid = newrow.find(".userid");
								var useridvalue = newrow.find(".userid-value");
								console.dir(input);
								$.ajax({
									url: "/team/find/user",
									type: "get",
									data: $.param({
										search: input.val()
									}),
									success: function(data) {
										row.empty();

										if (data && data.length === 1) {
											username.text(data[0].name);
											userid.text(data[0].id);
											useridvalue.val(data[0].id);
											avatar.attr("src", data[0].avatar);

											newrow.find(".remove-user").click(deleteRow);

											row.append(newrow);
										}
									}
								});
							}

							$(".discord-search").click(discordSearch);
						});
					</script>
					<div class="row" style="margin-bottom: 14px;">
						<div class="col-8 offset-2">
							<div class="float-right">
								<button type="submit" class="btn btn-primary">Submit</button>
							</div>
						</div>
					</div>
				</div>
			</form>
		<% } %>
	</div>
</body>
</html>